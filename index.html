<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Hotel Booking Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #334155;
            line-height: 1.6;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 2rem 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 1rem;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
            to { box-shadow: 0 0 15px rgba(16, 185, 129, 0.8); }
        }

        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #dcfce7;
            color: #166534;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-content {
            padding: 2rem 0;
        }

        .filters-section {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .filter-select, .filter-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .insights-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .insights-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .insights-card.green-flags {
            border-left: 4px solid #10b981;
        }

        .insights-card.red-flags {
            border-left: 4px solid #ef4444;
        }

        .insights-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .insights-title.green {
            color: #059669;
        }

        .insights-title.red {
            color: #dc2626;
        }

        .insight-item {
            display: flex;
            align-items: start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .insight-icon.green {
            background: #10b981;
        }

        .insight-icon.red {
            background: #ef4444;
        }

        .insight-icon.orange {
            background: #f59e0b;
        }

        .insight-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .insight-text strong {
            color: #1e293b;
        }

        .nav-tabs {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            padding: 0.75rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            display: flex;
            gap: 0.75rem;
            overflow-x: auto;
            position: relative;
            animation: slideIn 0.6s ease-out;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            border-radius: 1rem;
            z-index: -1;
            animation: rainbow 3s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav-tabs:hover::before {
            opacity: 1;
        }

        @keyframes rainbow {
            0%, 100% { background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7); }
            25% { background: linear-gradient(45deg, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #ff6b6b); }
            50% { background: linear-gradient(45deg, #45b7d1, #96ceb4, #ffeaa7, #ff6b6b, #4ecdc4); }
            75% { background: linear-gradient(45deg, #96ceb4, #ffeaa7, #ff6b6b, #4ecdc4, #45b7d1); }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .nav-tab {
            padding: 1rem 1.75rem;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border-radius: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav-tab:hover::before {
            opacity: 1;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #fff, #f8fafc);
            color: #1e293b;
            box-shadow: 
                0 8px 32px rgba(255,255,255,0.3),
                0 2px 8px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.5);
            transform: translateY(-2px);
            text-shadow: none;
            animation: activeTab 0.3s ease-out;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        @keyframes activeTab {
            0% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-4px) scale(1.05);
            }
            100% {
                transform: translateY(-2px) scale(1);
            }
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(255,255,255,0.2);
        }

        .nav-tab:active {
            transform: translateY(0) scale(0.98);
        }

        /* Add icons to tabs with enhanced styling */
        .nav-tab[data-tab="overview"]::after {
            content: '📊';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite;
        }

        .nav-tab[data-tab="yesterday"]::after {
            content: '📅';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite 0.5s;
        }

        .nav-tab[data-tab="suppliers"]::after {
            content: '🎯';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite 1s;
        }

        .nav-tab[data-tab="trends"]::after {
            content: '📈';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite 1.5s;
        }

        .nav-tab[data-tab="predictions"]::after {
            content: '🔮';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite 2s;
        }

        .nav-tab[data-tab="optimization"]::after {
            content: '⚡';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite 2.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .metric-card.blue { border-left-color: #3b82f6; }
        .metric-card.green { border-left-color: #10b981; }
        .metric-card.purple { border-left-color: #8b5cf6; }
        .metric-card.orange { border-left-color: #f59e0b; }

        .metric-title {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-change.positive { color: #059669; }
        .metric-change.negative { color: #dc2626; }

        .trend-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
        }

        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .chart-header {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .chart-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chart-btn:hover, .chart-btn.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #eff6ff;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .supplier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .supplier-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #e2e8f0;
            transition: all 0.2s;
        }

        .supplier-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .supplier-card.top-performer {
            border-left-color: #10b981;
        }

        .supplier-card.needs-attention {
            border-left-color: #f59e0b;
        }

        .supplier-card.underperforming {
            border-left-color: #ef4444;
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .supplier-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .supplier-score {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .supplier-score.excellent {
            background: #dcfce7;
            color: #166534;
        }

        .supplier-score.good {
            background: #fef3c7;
            color: #92400e;
        }

        .supplier-score.poor {
            background: #fecaca;
            color: #991b1b;
        }

        .supplier-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .supplier-stat {
            text-align: center;
        }

        .supplier-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }

        .supplier-stat-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #64748b;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        /* Security & Login Styles */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-container {
            background: white;
            padding: 3rem;
            border-radius: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #64748b;
            margin-bottom: 2rem;
        }

        .login-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .login-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .error-login {
            background: #fef2f2;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        /* Advanced Date Filter Styles */
        .advanced-filters {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(59, 130, 246, 0.1);
        }

        .date-picker-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .date-picker-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .date-input {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .date-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .quick-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .quick-filter-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .quick-filter-btn:hover, .quick-filter-btn.active {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
        }

        /* Yesterday Analysis Styles */
        .yesterday-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .yesterday-metrics {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #8b5cf6;
        }

        .yesterday-alerts {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }

        .alert-item.surge {
            background: #f0fdf4;
            border-left: 3px solid #10b981;
        }

        .alert-item.dip {
            background: #fef2f2;
            border-left: 3px solid #ef4444;
        }

        .alert-item.unusual {
            background: #fef3c7;
            border-left: 3px solid #f59e0b;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                padding: 1rem;
            }
            
            .chart-wrapper {
                height: 300px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Hotel Booking Analytics Dashboard 
                <span class="ai-badge">
                    🧠 AI-Powered
                </span>
            </h1>
            <div class="subtitle">
                <span id="summary-stats">Loading...</span>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="last-updated">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <!-- Smart Filters Section -->
            <div class="filters-section">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Date Range</label>
                        <select class="filter-select" id="dateRange" onchange="applyFilters()">
                            <option value="all">All Time</option>
                            <option value="7">Last 7 Days</option>
                            <option value="14">Last 14 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                            <option value="60">Last 60 Days</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Supplier Performance</label>
                        <select class="filter-select" id="performanceFilter" onchange="applyFilters()">
                            <option value="all">All Suppliers</option>
                            <option value="top">Top Performers</option>
                            <option value="growing">Growing Fast</option>
                            <option value="declining">Declining</option>
                            <option value="inconsistent">Inconsistent</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Minimum Bookings</label>
                        <input type="number" class="filter-input" id="minBookings" placeholder="e.g., 50" onchange="applyFilters()">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Supplier Name</label>
                        <input type="text" class="filter-input" id="supplierSearch" placeholder="Search suppliers..." oninput="applyFilters()">
                    </div>
                    <div class="filter-group">
                        <button class="filter-btn" onclick="resetFilters()">Reset All</button>
                    </div>
                </div>
            </div>

            <!-- AI Insights Section -->
            <div class="insights-section">
                <div class="insights-card green-flags">
                    <div class="insights-title green">
                        🟢 Green Flags - Opportunities
                    </div>
                    <div id="green-insights">
                        <div class="loading">
                            <div class="spinner"></div>
                            Analyzing opportunities...
                        </div>
                    </div>
                </div>
                <div class="insights-card red-flags">
                    <div class="insights-title red">
                        🔴 Red Flags - Action Required
                    </div>
                    <div id="red-insights">
                        <div class="loading">
                            <div class="spinner"></div>
                            Identifying issues...
                        </div>
                    </div>
                </div>
            </div>

            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="overview" onclick="switchTab('overview')">Business Overview</button>
                <button class="nav-tab" data-tab="yesterday" onclick="switchTab('yesterday')">Yesterday's Report</button>
                <button class="nav-tab" data-tab="suppliers" onclick="switchTab('suppliers')">Smart Supplier Analysis</button>
                <button class="nav-tab" data-tab="trends" onclick="switchTab('trends')">Trend Intelligence</button>
                <button class="nav-tab" data-tab="predictions" onclick="switchTab('predictions')">AI Predictions</button>
                <button class="nav-tab" data-tab="optimization" onclick="switchTab('optimization')">Optimization Hub</button>
            </nav>

            <!-- Advanced Date Filters -->
            <div class="advanced-filters">
                <h3 style="margin-bottom: 1rem; color: #1e293b; font-weight: 600;">📅 Smart Date Controls</h3>
                <div class="date-picker-section">
                    <div class="date-picker-group">
                        <label class="filter-label">From Date</label>
                        <input type="date" class="date-input" id="startDate" onchange="applyDateFilter()">
                    </div>
                    <div class="date-picker-group">
                        <label class="filter-label">To Date</label>
                        <input type="date" class="date-input" id="endDate" onchange="applyDateFilter()">
                    </div>
                    <div class="date-picker-group">
                        <label class="filter-label">Apply To</label>
                        <select class="filter-select" id="chartTarget">
                            <option value="all">All Charts</option>
                            <option value="overview">Overview Only</option>
                            <option value="trends">Trends Only</option>
                            <option value="predictions">Predictions Only</option>
                        </select>
                    </div>
                </div>
                <div class="quick-filters">
                    <button class="quick-filter-btn" onclick="setQuickDate('today')">Today</button>
                    <button class="quick-filter-btn active" onclick="setQuickDate('yesterday')">Yesterday</button>
                    <button class="quick-filter-btn" onclick="setQuickDate('week')">Last 7 Days</button>
                    <button class="quick-filter-btn" onclick="setQuickDate('month')">Last 30 Days</button>
                    <button class="quick-filter-btn" onclick="setQuickDate('quarter')">Last 90 Days</button>
                    <button class="quick-filter-btn" onclick="setQuickDate('all')">All Time</button>
                </div>
            </div>

            <!-- Business Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="metrics-grid">
                    <div class="metric-card blue">
                        <div class="metric-title">Total Bookings</div>
                        <div class="metric-value" id="total-bookings">Loading...</div>
                        <div class="metric-change positive" id="bookings-change">
                            ↗ Loading...
                        </div>
                        <div class="trend-indicator" id="bookings-trend">📈</div>
                    </div>
                    
                    <div class="metric-card green">
                        <div class="metric-title">Total GMV</div>
                        <div class="metric-value" id="total-gmv">Loading...</div>
                        <div class="metric-change positive" id="gmv-change">
                            ↗ Loading...
                        </div>
                        <div class="trend-indicator" id="gmv-trend">📈</div>
                    </div>
                    
                    <div class="metric-card purple">
                        <div class="metric-title">Avg Booking Value</div>
                        <div class="metric-value" id="avg-booking-value">Loading...</div>
                        <div class="metric-change" id="avg-change">Loading...</div>
                        <div class="trend-indicator" id="avg-trend">📊</div>
                    </div>
                    
                    <div class="metric-card orange">
                        <div class="metric-title">Active Suppliers</div>
                        <div class="metric-value" id="active-suppliers">Loading...</div>
                        <div class="metric-change" id="suppliers-change">↗ All Active</div>
                        <div class="trend-indicator" id="suppliers-trend">🎯</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Daily Performance Trends with AI Insights</h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="toggleChartType('line')">Line</button>
                            <button class="chart-btn" onclick="toggleChartType('bar')">Bar</button>
                            <button class="chart-btn" onclick="toggleChartMetric('bookings')">Bookings</button>
                            <button class="chart-btn" onclick="toggleChartMetric('gmv')">GMV</button>
                            <button class="chart-btn" onclick="toggleChartMetric('both')">Both</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="overviewChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Smart Supplier Analysis Tab -->
            <div id="suppliers" class="tab-content">
                <div id="supplier-grid" class="supplier-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        Analyzing supplier performance...
                    </div>
                </div>
            </div>

            <!-- Trend Intelligence Tab -->
            <div id="trends" class="tab-content">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Intelligent Trend Analysis</h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="filterTopSuppliers('all')">All Suppliers</button>
                            <button class="chart-btn" onclick="filterTopSuppliers('top5')">Top 5</button>
                            <button class="chart-btn" onclick="filterTopSuppliers('top10')">Top 10</button>
                            <button class="chart-btn" onclick="filterTopSuppliers('growing')">Growing</button>
                            <button class="chart-btn" onclick="filterTopSuppliers('volatile')">Volatile</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- AI Predictions Tab -->
            <div id="predictions" class="tab-content">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">AI Performance Predictions</h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="showPrediction('7days')">Next 7 Days</button>
                            <button class="chart-btn" onclick="showPrediction('trends')">Growth Trends</button>
                            <button class="chart-btn" onclick="showPrediction('seasonal')">Seasonal Analysis</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="predictionsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Optimization Hub Tab -->
            <div id="optimization" class="tab-content">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Supplier Optimization Matrix</h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="showOptimization('performance')">Performance vs Volume</button>
                            <button class="chart-btn" onclick="showOptimization('efficiency')">Efficiency Analysis</button>
                            <button class="chart-btn" onclick="showOptimization('potential')">Growth Potential</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="optimizationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    <script>
        // Security Configuration
        const DASHBOARD_CONFIG = {
            requireAuth: true, // Set to false to disable login
            organizationName: "Your Hotel Business",
            authorizedUsers: [
                { email: "admin@yourhotel.com", password: "dashboard2025!", role: "admin" },
                { email: "manager@yourhotel.com", password: "manager123!", role: "manager" },
                { email: "analyst@yourhotel.com", password: "analyst123!", role: "analyst" }
            ],
            sessionTimeout: 8 * 60 * 60 * 1000 // 8 hours
        };

        let isAuthenticated = false;
        let currentUser = null;
        let rawBookingData = [];
        let processedData = {};
        let filteredData = {};
        let charts = {};
        let currentChartType = 'line';
        let currentFilter = 'all';
        let currentMetric = 'bookings';
        let currentPredictionType = '7days';
        let currentOptimizationType = 'performance';
        let currentDateFilter = { start: null, end: null };
        let aiInsights = {};

        // Security Functions
        function showLoginScreen() {
            if (!DASHBOARD_CONFIG.requireAuth) {
                initializeDashboard();
                return;
            }

            const loginOverlay = document.createElement('div');
            loginOverlay.className = 'login-overlay';
            loginOverlay.innerHTML = `
                <div class="login-container">
                    <h2 class="login-title">🔒 Secure Access Required</h2>
                    <p class="login-subtitle">This dashboard contains sensitive business data for ${DASHBOARD_CONFIG.organizationName}</p>
                    <div id="login-error" style="display: none;"></div>
                    <input type="email" class="login-input" id="emailInput" placeholder="Enter your email" required>
                    <input type="password" class="login-input" id="passwordInput" placeholder="Enter your password" required>
                    <button class="login-btn" onclick="attemptLogin()">🚀 Access Dashboard</button>
                    <p style="font-size: 0.75rem; color: #64748b; margin-top: 1rem;">
                        Contact administrator for access approval
                    </p>
                </div>
            `;
            document.body.appendChild(loginOverlay);

            // Add enter key support
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') attemptLogin();
            });
        }

        function attemptLogin() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('login-error');

            const user = DASHBOARD_CONFIG.authorizedUsers.find(u => u.email === email && u.password === password);
            
            if (user) {
                isAuthenticated = true;
                currentUser = user;
                
                // Store session with expiration
                const session = {
                    user: user,
                    loginTime: Date.now(),
                    expires: Date.now() + DASHBOARD_CONFIG.sessionTimeout
                };
                sessionStorage.setItem('dashboardSession', JSON.stringify(session));
                
                // Remove login overlay
                document.querySelector('.login-overlay').remove();
                initializeDashboard();
                
                showSuccess(`Welcome back, ${user.email}! You have ${user.role} access.`);
            } else {
                errorDiv.className = 'error-login';
                errorDiv.textContent = '❌ Invalid credentials. Contact administrator for access.';
                errorDiv.style.display = 'block';
                
                // Clear password field
                document.getElementById('passwordInput').value = '';
            }
        }

        function checkSession() {
            if (!DASHBOARD_CONFIG.requireAuth) return true;

            const sessionData = sessionStorage.getItem('dashboardSession');
            if (!sessionData) return false;

            try {
                const session = JSON.parse(sessionData);
                if (Date.now() > session.expires) {
                    sessionStorage.removeItem('dashboardSession');
                    return false;
                }
                
                isAuthenticated = true;
                currentUser = session.user;
                return true;
            } catch (error) {
                sessionStorage.removeItem('dashboardSession');
                return false;
            }
        }

        function logout() {
            sessionStorage.removeItem('dashboardSession');
            location.reload();
        }

        // Advanced Date Filtering Functions
        function setQuickDate(period) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            
            let startDate, endDate;
            
            switch (period) {
                case 'today':
                    startDate = endDate = today;
                    break;
                case 'yesterday':
                    startDate = endDate = yesterday;
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    endDate = today;
                    break;
                case 'month':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 30);
                    endDate = today;
                    break;
                case 'quarter':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 90);
                    endDate = today;
                    break;
                case 'all':
                    startDate = endDate = null;
                    break;
            }

            // Update date inputs
            if (startDate) {
                document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            } else {
                document.getElementById('startDate').value = '';
            }
            
            if (endDate) {
                document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            } else {
                document.getElementById('endDate').value = '';
            }

            // Update button states
            document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            applyDateFilter();
        }

        function applyDateFilter() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const target = document.getElementById('chartTarget').value;

            currentDateFilter = {
                start: startDate ? new Date(startDate) : null,
                end: endDate ? new Date(endDate) : null,
                target: target
            };

            // Apply to specified charts
            if (target === 'all' || target === 'overview') {
                applyFilters();
            }
            
            updateChartsWithDateFilter();
        }

        function updateChartsWithDateFilter() {
            const target = currentDateFilter.target;
            
            if (target === 'all') {
                createCharts();
            } else if (target === 'overview') {
                createOverviewChart();
            } else if (target === 'trends') {
                createTrendsChart();
            } else if (target === 'predictions') {
                createPredictionsChart();
            }
        }

        // Yesterday Analysis Functions
        function analyzeYesterday() {
            if (!processedData.dailyTotals) return;

            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const lastWeek = new Date(today);
            lastWeek.setDate(today.getDate() - 8); // Same day last week

            const yesterdayStr = yesterday.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const lastWeekStr = lastWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

            // Find yesterday's data
            const yesterdayData = processedData.dailyTotals[yesterdayStr] || { bookings: 0, gmv: 0 };
            const lastWeekData = processedData.dailyTotals[lastWeekStr] || { bookings: 0, gmv: 0 };

            // Calculate changes
            const bookingsChange = lastWeekData.bookings > 0 ? 
                ((yesterdayData.bookings - lastWeekData.bookings) / lastWeekData.bookings * 100) : 0;
            const gmvChange = lastWeekData.gmv > 0 ? 
                ((yesterdayData.gmv - lastWeekData.gmv) / lastWeekData.gmv * 100) : 0;

            // Update yesterday metrics
            document.getElementById('yesterday-bookings').textContent = yesterdayData.bookings.toLocaleString();
            document.getElementById('yesterday-gmv').textContent = '₹' + (yesterdayData.gmv / 10000000).toFixed(2) + 'Cr';
            
            const avgValue = yesterdayData.bookings > 0 ? yesterdayData.gmv / yesterdayData.bookings : 0;
            document.getElementById('yesterday-avg-value').textContent = '₹' + Math.round(avgValue/1000) + 'k';

            // Count active suppliers yesterday
            const activeYesterday = processedData.suppliers.filter(supplier => 
                processedData.supplierData[supplier][yesterdayStr]?.bookings > 0
            ).length;
            document.getElementById('yesterday-suppliers').textContent = activeYesterday;

            // Update change indicators
            document.getElementById('yesterday-bookings-change').textContent = 
                `${bookingsChange >= 0 ? '↗' : '↘'} ${Math.abs(bookingsChange).toFixed(1)}% vs last week`;
            document.getElementById('yesterday-bookings-change').className = 
                `metric-change ${bookingsChange >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('yesterday-gmv-change').textContent = 
                `${gmvChange >= 0 ? '↗' : '↘'} ${Math.abs(gmvChange).toFixed(1)}% vs last week`;

            // Generate AI alerts for yesterday
            generateYesterdayAlerts(yesterdayStr, lastWeekStr);
            createYesterdayChart();
        }

        function generateYesterdayAlerts(yesterdayStr, lastWeekStr) {
            const container = document.getElementById('yesterday-alerts-container');
            container.innerHTML = '';

            const alerts = [];

            // Analyze each supplier's yesterday performance
            processedData.suppliers.forEach(supplier => {
                const yesterday = processedData.supplierData[supplier][yesterdayStr] || { bookings: 0, gmv: 0 };
                const lastWeek = processedData.supplierData[supplier][lastWeekStr] || { bookings: 0, gmv: 0 };

                if (yesterday.bookings === 0 && lastWeek.bookings > 10) {
                    alerts.push({
                        type: 'dip',
                        icon: '🔴',
                        message: `${supplier} had ZERO bookings yesterday (vs ${lastWeek.bookings} last week)`
                    });
                } else if (yesterday.bookings > 0 && lastWeek.bookings > 0) {
                    const change = ((yesterday.bookings - lastWeek.bookings) / lastWeek.bookings) * 100;
                    
                    if (change > 50) {
                        alerts.push({
                            type: 'surge',
                            icon: '🟢',
                            message: `${supplier} surged +${change.toFixed(1)}% (${yesterday.bookings} vs ${lastWeek.bookings})`
                        });
                    } else if (change < -30) {
                        alerts.push({
                            type: 'dip',
                            icon: '🔴',
                            message: `${supplier} dropped ${change.toFixed(1)}% (${yesterday.bookings} vs ${lastWeek.bookings})`
                        });
                    }
                }

                // Check for unusual booking values
                if (yesterday.bookings > 0) {
                    const avgValue = yesterday.gmv / yesterday.bookings;
                    const lastWeekAvg = lastWeek.bookings > 0 ? lastWeek.gmv / lastWeek.bookings : 0;
                    
                    if (lastWeekAvg > 0) {
                        const valueChange = ((avgValue - lastWeekAvg) / lastWeekAvg) * 100;
                        if (Math.abs(valueChange) > 25) {
                            alerts.push({
                                type: 'unusual',
                                icon: '🟡',
                                message: `${supplier} booking value ${valueChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(valueChange).toFixed(1)}%`
                            });
                        }
                    }
                }
            });

            // Sort alerts by importance
            alerts.sort((a, b) => {
                const priority = { dip: 3, surge: 2, unusual: 1 };
                return priority[b.type] - priority[a.type];
            });

            // Display top 8 alerts
            alerts.slice(0, 8).forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert-item ${alert.type}`;
                alertDiv.innerHTML = `
                    <span class="alert-icon">${alert.icon}</span>
                    <span class="alert-text">${alert.message}</span>
                `;
                container.appendChild(alertDiv);
            });

            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="alert-item" style="background: #f0fdf4; border-left: 3px solid #10b981;">
                        <span class="alert-icon">✅</span>
                        <span class="alert-text">No significant alerts for yesterday. All suppliers performing normally!</span>
                    </div>
                `;
            }
        }

        let currentYesterdayView = 'rankings';

        function createYesterdayChart() {
            const ctx = document.getElementById('yesterdayChart').getContext('2d');
            
            if (charts.yesterday) {
                charts.yesterday.destroy();
            }

            switch (currentYesterdayView) {
                case 'rankings':
                    createYesterdayRankings(ctx);
                    break;
                case 'comparison':
                    createYesterdayComparison(ctx);
                    break;
                case 'hourly':
                    createYesterdayHourlyPattern(ctx);
                    break;
            }
        }

        function createYesterdayRankings(ctx) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const yesterdayStr = yesterday.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

            const supplierPerformance = processedData.suppliers
                .map(supplier => ({
                    name: supplier,
                    bookings: processedData.supplierData[supplier][yesterdayStr]?.bookings || 0,
                    gmv: processedData.supplierData[supplier][yesterdayStr]?.gmv || 0
                }))
                .filter(s => s.bookings > 0)
                .sort((a, b) => b.bookings - a.bookings)
                .slice(0, 15);

            charts.yesterday = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: supplierPerformance.map(s => s.name),
                    datasets: [{
                        label: 'Yesterday\'s Bookings',
                        data: supplierPerformance.map(s => s.bookings),
                        backgroundColor: supplierPerformance.map((s, i) => {
                            if (i < 3) return '#10b981'; // Top 3
                            if (i < 8) return '#3b82f6'; // Top 8
                            return '#f59e0b'; // Others
                        }),
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: `Yesterday's Top Performers - ${yesterdayStr}`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { color: '#f1f5f9' },
                            ticks: { maxRotation: 45 }
                        }
                    }
                }
            });
        }

        function createYesterdayComparison(ctx) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const lastWeek = new Date(today);
            lastWeek.setDate(today.getDate() - 8);

            const yesterdayStr = yesterday.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const lastWeekStr = lastWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

            const comparison = processedData.suppliers
                .map(supplier => {
                    const yesterdayBookings = processedData.supplierData[supplier][yesterdayStr]?.bookings || 0;
                    const lastWeekBookings = processedData.supplierData[supplier][lastWeekStr]?.bookings || 0;
                    return {
                        name: supplier,
                        yesterday: yesterdayBookings,
                        lastWeek: lastWeekBookings,
                        change: lastWeekBookings > 0 ? ((yesterdayBookings - lastWeekBookings) / lastWeekBookings * 100) : 0
                    };
                })
                .filter(s => s.yesterday > 0 || s.lastWeek > 0)
                .sort((a, b) => Math.abs(b.change) - Math.abs(a.change))
                .slice(0, 12);

            charts.yesterday = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: comparison.map(s => s.name),
                    datasets: [
                        {
                            label: 'Yesterday',
                            data: comparison.map(s => s.yesterday),
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        },
                        {
                            label: 'Same Day Last Week',
                            data: comparison.map(s => s.lastWeek),
                            backgroundColor: '#94a3b8',
                            borderColor: '#64748b',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Yesterday vs Same Day Last Week Comparison'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { color: '#f1f5f9' },
                            ticks: { maxRotation: 45 }
                        }
                    }
                }
            });
        }

        function createYesterdayHourlyPattern(ctx) {
            // Simulate hourly distribution (since we don't have hourly data)
            const hourlyPattern = Array.from({length: 24}, (_, hour) => {
                // Business hours pattern simulation
                let factor = 0.1; // Base activity
                if (hour >= 9 && hour <= 11) factor = 0.8; // Morning peak
                if (hour >= 14 && hour <= 16) factor = 1.0; // Afternoon peak  
                if (hour >= 18 && hour <= 20) factor = 0.6; // Evening activity
                if (hour >= 22 || hour <= 6) factor = 0.05; // Night low activity
                
                return Math.floor(Math.random() * 50 * factor + factor * 20);
            });

            charts.yesterday = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                    datasets: [{
                        label: 'Estimated Hourly Bookings',
                        data: hourlyPattern,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Yesterday\'s Estimated Hourly Booking Pattern'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { color: '#f1f5f9' }
                        }
                    }
                }
            });
        }

        function toggleYesterdayView(view) {
            currentYesterdayView = view;
            
            document.querySelectorAll('#yesterday .chart-controls .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            createYesterdayChart();
        }

        // Load and initialize
        async function loadBookingData() {
            try {
                showLoading();
                
                const response = await fetch('Hotel API v2_Supplier Level_Pivot table 2.csv');
                if (!response.ok) {
                    throw new Error(`Failed to load data: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    quotes: true,        // Handle quoted fields
                    quoteChar: '"',      // Specify quote character
                    escapeChar: '"',     // Handle escaped quotes
                    delimiter: ',',      // Specify comma delimiter
                    complete: function(results) {
                        rawBookingData = results.data;
                        console.log('Loaded booking data:', rawBookingData.length, 'rows');
                        
                        processData();
                        generateAIInsights();
                        updateMetrics();
                        createCharts();
                        createSupplierCards();
                        applyFilters(); // Apply default filters
                        hideLoading();
                        showSuccess('Dashboard loaded with AI insights!');
                    },
                    error: function(error) {
                        console.error('CSV parsing error:', error);
                        showError('Failed to parse CSV data: ' + error.message);
                    }
                });
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load booking data. Please check that the CSV file exists.');
                hideLoading();
            }
        }

        // Enhanced data processing with AI analysis
        function processData() {
            if (rawBookingData.length === 0) return;

            const uniqueSuppliers = [...new Set(rawBookingData.map(row => row.name))].filter(Boolean);
            const uniqueDates = [...new Set(rawBookingData.map(row => row['booking_date (Date)']))].filter(Boolean);
            
            uniqueDates.sort((a, b) => new Date(a) - new Date(b));

            const dailyTotals = {};
            const supplierData = {};
            const supplierTotals = {};

            // Initialize structures
            uniqueSuppliers.forEach(supplier => {
                supplierData[supplier] = {};
                supplierTotals[supplier] = { bookings: 0, gmv: 0, days: 0 };
                uniqueDates.forEach(date => {
                    supplierData[supplier][date] = { bookings: 0, gmv: 0 };
                });
            });

            uniqueDates.forEach(date => {
                dailyTotals[date] = { bookings: 0, gmv: 0 };
            });

            // Aggregate data
            rawBookingData.forEach(row => {
                if (row.name && row['booking_date (Date)']) {
                    const supplier = row.name;
                    const date = row['booking_date (Date)'];
                    const bookings = parseInt(row.id) || 0;
                    const gmv = parseInt(row.amount_in_inr) || 0;

                    if (supplierData[supplier] && supplierData[supplier][date]) {
                        supplierData[supplier][date].bookings += bookings;
                        supplierData[supplier][date].gmv += gmv;
                        
                        supplierTotals[supplier].bookings += bookings;
                        supplierTotals[supplier].gmv += gmv;
                        if (bookings > 0) supplierTotals[supplier].days += 1;
                    }

                    if (dailyTotals[date]) {
                        dailyTotals[date].bookings += bookings;
                        dailyTotals[date].gmv += gmv;
                    }
                }
            });

            processedData = {
                suppliers: uniqueSuppliers,
                dates: uniqueDates,
                dailyTotals: dailyTotals,
                supplierData: supplierData,
                supplierTotals: supplierTotals
            };

            // Set initial filtered data
            filteredData = { ...processedData };
        }

        // Generate AI-powered insights
        function generateAIInsights() {
            if (!processedData.supplierTotals) return;

            const suppliers = Object.entries(processedData.supplierTotals);
            const greenFlags = [];
            const redFlags = [];

            // Calculate metrics for insights
            suppliers.forEach(([name, data]) => {
                const avgBookingValue = data.bookings > 0 ? data.gmv / data.bookings : 0;
                const dailyAvg = data.days > 0 ? data.bookings / data.days : 0;
                
                // Green flags - opportunities
                if (data.bookings > 1000 && avgBookingValue > 20000) {
                    greenFlags.push({
                        type: 'opportunity',
                        supplier: name,
                        message: `High-value partner with ${data.bookings.toLocaleString()} bookings and ₹${Math.round(avgBookingValue/1000)}k avg booking value`
                    });
                }
                
                if (dailyAvg > 50 && data.days > 20) {
                    greenFlags.push({
                        type: 'consistent',
                        supplier: name,
                        message: `Consistent performer with ${dailyAvg.toFixed(1)} bookings/day over ${data.days} active days`
                    });
                }

                // Red flags - issues
                if (data.bookings > 0 && avgBookingValue < 10000) {
                    redFlags.push({
                        type: 'low-value',
                        supplier: name,
                        message: `Low booking value: ₹${Math.round(avgBookingValue/1000)}k avg (consider pricing optimization)`
                    });
                }

                if (data.days < 10 && data.bookings > 100) {
                    redFlags.push({
                        type: 'inconsistent',
                        supplier: name,
                        message: `Inconsistent activity: ${data.bookings} bookings over only ${data.days} days`
                    });
                }
            });

            // Sort by importance
            greenFlags.sort((a, b) => (b.type === 'opportunity' ? 1 : -1));
            redFlags.sort((a, b) => (b.type === 'low-value' ? 1 : -1));

            aiInsights = {
                greenFlags: greenFlags.slice(0, 5),
                redFlags: redFlags.slice(0, 5)
            };

            updateInsightsDisplay();
        }

        // Update AI insights display
        function updateInsightsDisplay() {
            const greenContainer = document.getElementById('green-insights');
            const redContainer = document.getElementById('red-insights');

            // Green flags
            greenContainer.innerHTML = '';
            if (aiInsights.greenFlags.length === 0) {
                greenContainer.innerHTML = '<div class="insight-item"><div class="insight-text">All systems running optimally! 🎉</div></div>';
            } else {
                aiInsights.greenFlags.forEach(insight => {
                    const item = document.createElement('div');
                    item.className = 'insight-item';
                    item.innerHTML = `
                        <div class="insight-icon green">✓</div>
                        <div class="insight-text">
                            <strong>${insight.supplier}:</strong> ${insight.message}
                        </div>
                    `;
                    greenContainer.appendChild(item);
                });
            }

            // Red flags  
            redContainer.innerHTML = '';
            if (aiInsights.redFlags.length === 0) {
                redContainer.innerHTML = '<div class="insight-item"><div class="insight-text">No critical issues detected! ✨</div></div>';
            } else {
                aiInsights.redFlags.forEach(insight => {
                    const item = document.createElement('div');
                    item.className = 'insight-item';
                    item.innerHTML = `
                        <div class="insight-icon red">!</div>
                        <div class="insight-text">
                            <strong>${insight.supplier}:</strong> ${insight.message}
                        </div>
                    `;
                    redContainer.appendChild(item);
                });
            }
        }

        // Apply smart filters
        function applyFilters() {
            const dateRange = document.getElementById('dateRange').value;
            const performanceFilter = document.getElementById('performanceFilter').value;
            const minBookings = parseInt(document.getElementById('minBookings').value) || 0;
            const supplierSearch = document.getElementById('supplierSearch').value.toLowerCase();

            // Start with full processed data
            let filtered = JSON.parse(JSON.stringify(processedData));

            // Apply date range filter
            if (dateRange !== 'all') {
                const days = parseInt(dateRange);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                filtered.dates = filtered.dates.filter(date => new Date(date) >= cutoffDate);
                
                // Recalculate dailyTotals for filtered dates
                const newDailyTotals = {};
                filtered.dates.forEach(date => {
                    newDailyTotals[date] = filtered.dailyTotals[date];
                });
                filtered.dailyTotals = newDailyTotals;
            }

            // Apply supplier search filter
            if (supplierSearch) {
                filtered.suppliers = filtered.suppliers.filter(supplier => 
                    supplier.toLowerCase().includes(supplierSearch)
                );
            }

            // Apply minimum bookings filter
            if (minBookings > 0) {
                filtered.suppliers = filtered.suppliers.filter(supplier => 
                    filtered.supplierTotals[supplier].bookings >= minBookings
                );
            }

            // Apply performance filter
            if (performanceFilter !== 'all') {
                const suppliers = filtered.suppliers.map(supplier => ({
                    name: supplier,
                    ...filtered.supplierTotals[supplier]
                })).sort((a, b) => b.bookings - a.bookings);

                switch (performanceFilter) {
                    case 'top':
                        filtered.suppliers = suppliers.slice(0, 10).map(s => s.name);
                        break;
                    case 'growing':
                        // Simple growth detection - suppliers with recent activity
                        const recentDates = filtered.dates.slice(-7);
                        filtered.suppliers = filtered.suppliers.filter(supplier => {
                            const recentBookings = recentDates.reduce((sum, date) => {
                                return sum + (filtered.supplierData[supplier][date]?.bookings || 0);
                            }, 0);
                            return recentBookings > 0;
                        });
                        break;
                    case 'declining':
                        // Suppliers with low recent activity but historical data
                        const recent = filtered.dates.slice(-7);
                        const older = filtered.dates.slice(-14, -7);
                        filtered.suppliers = filtered.suppliers.filter(supplier => {
                            const recentSum = recent.reduce((sum, date) => sum + (filtered.supplierData[supplier][date]?.bookings || 0), 0);
                            const olderSum = older.reduce((sum, date) => sum + (filtered.supplierData[supplier][date]?.bookings || 0), 0);
                            return olderSum > recentSum && olderSum > 50;
                        });
                        break;
                    case 'inconsistent':
                        filtered.suppliers = filtered.suppliers.filter(supplier => 
                            filtered.supplierTotals[supplier].days < 15 && filtered.supplierTotals[supplier].bookings > 100
                        );
                        break;
                }
            }

            filteredData = filtered;
            updateMetrics();
            createCharts();
            createSupplierCards();
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('dateRange').value = 'all';
            document.getElementById('performanceFilter').value = 'all';
            document.getElementById('minBookings').value = '';
            document.getElementById('supplierSearch').value = '';
            applyFilters();
        }

        // Create supplier performance cards
        function createSupplierCards() {
            const container = document.getElementById('supplier-grid');
            container.innerHTML = '';

            if (!filteredData.supplierTotals) return;

            const suppliers = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .map(([name, data]) => {
                    const avgBookingValue = data.bookings > 0 ? data.gmv / data.bookings : 0;
                    const dailyAvg = data.days > 0 ? data.bookings / data.days : 0;
                    
                    // Calculate performance score
                    let score = 0;
                    if (data.bookings > 500) score += 25;
                    if (avgBookingValue > 15000) score += 25;
                    if (dailyAvg > 20) score += 25;
                    if (data.days > 15) score += 25;
                    
                    let tier = 'underperforming';
                    let scoreLabel = 'Needs Work';
                    if (score >= 75) { tier = 'top-performer'; scoreLabel = 'Excellent'; }
                    else if (score >= 50) { tier = 'needs-attention'; scoreLabel = 'Good'; }
                    
                    return { name, data, avgBookingValue, dailyAvg, score, tier, scoreLabel };
                })
                .sort((a, b) => b.score - a.score);

            suppliers.forEach(supplier => {
                const card = document.createElement('div');
                card.className = `supplier-card ${supplier.tier}`;
                card.innerHTML = `
                    <div class="supplier-header">
                        <div class="supplier-name">${supplier.name}</div>
                        <div class="supplier-score ${supplier.scoreLabel.toLowerCase()}">${supplier.scoreLabel}</div>
                    </div>
                    <div class="supplier-stats">
                        <div class="supplier-stat">
                            <div class="supplier-stat-value">${supplier.data.bookings.toLocaleString()}</div>
                            <div class="supplier-stat-label">Total Bookings</div>
                        </div>
                        <div class="supplier-stat">
                            <div class="supplier-stat-value">₹${Math.round(supplier.avgBookingValue/1000)}k</div>
                            <div class="supplier-stat-label">Avg Value</div>
                        </div>
                        <div class="supplier-stat">
                            <div class="supplier-stat-value">${supplier.dailyAvg.toFixed(1)}</div>
                            <div class="supplier-stat-label">Daily Avg</div>
                        </div>
                        <div class="supplier-stat">
                            <div class="supplier-stat-value">${supplier.data.days}</div>
                            <div class="supplier-stat-label">Active Days</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Enhanced metrics calculation
        function updateMetrics() {
            if (!filteredData.dailyTotals) return;

            let totalBookings = 0;
            let totalGMV = 0;

            Object.values(filteredData.dailyTotals).forEach(day => {
                totalBookings += day.bookings;
                totalGMV += day.gmv;
            });

            const activeSuppliers = filteredData.suppliers.length;
            const avgBookingValue = totalBookings > 0 ? Math.round(totalGMV / totalBookings) : 0;

            // Calculate trends (compare last 7 days vs previous 7 days)
            const dates = filteredData.dates.slice().sort((a, b) => new Date(a) - new Date(b));
            const last7 = dates.slice(-7);
            const prev7 = dates.slice(-14, -7);

            const last7Bookings = last7.reduce((sum, date) => sum + (filteredData.dailyTotals[date]?.bookings || 0), 0);
            const prev7Bookings = prev7.reduce((sum, date) => sum + (filteredData.dailyTotals[date]?.bookings || 0), 0);

            const bookingsTrend = prev7Bookings > 0 ? ((last7Bookings - prev7Bookings) / prev7Bookings * 100) : 0;

            // Update DOM
            document.getElementById('total-bookings').textContent = totalBookings.toLocaleString();
            document.getElementById('total-gmv').textContent = '₹' + (totalGMV / 10000000).toFixed(2) + 'Cr';
            document.getElementById('avg-booking-value').textContent = '₹' + avgBookingValue.toLocaleString();
            document.getElementById('active-suppliers').textContent = activeSuppliers;

            // Update trend indicators
            document.getElementById('bookings-change').textContent = 
                `${bookingsTrend >= 0 ? '↗' : '↘'} ${Math.abs(bookingsTrend).toFixed(1)}% vs last week`;
            document.getElementById('bookings-change').className = 
                `metric-change ${bookingsTrend >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('summary-stats').textContent = 
                `${totalBookings.toLocaleString()} bookings • ₹${(totalGMV / 10000000).toFixed(2)}Cr GMV • ${activeSuppliers} suppliers`;

            document.getElementById('last-updated').textContent = 'Updated ' + new Date().toLocaleString();
        }

        // Enhanced chart creation with AI insights
        function createCharts() {
            createOverviewChart();
            createTrendsChart();
            createPredictionsChart();
            createOptimizationChart();
            analyzeYesterday(); // Add yesterday analysis
        }

        function createOverviewChart() {
            const ctx = document.getElementById('overviewChart').getContext('2d');
            
            if (charts.overview) {
                charts.overview.destroy();
            }

            if (!filteredData.dailyTotals) return;

            const labels = filteredData.dates.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            const bookingsData = filteredData.dates.map(date => filteredData.dailyTotals[date].bookings);
            const gmvData = filteredData.dates.map(date => filteredData.dailyTotals[date].gmv / 100000); // Scale GMV

            let datasets = [];
            
            if (currentMetric === 'bookings' || currentMetric === 'both') {
                datasets.push({
                    label: 'Total Bookings',
                    data: bookingsData,
                    borderColor: '#3b82f6',
                    backgroundColor: currentChartType === 'bar' ? '#3b82f6' : 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 2,
                    fill: currentChartType === 'line',
                    yAxisID: 'y'
                });
            }

            if (currentMetric === 'gmv' || currentMetric === 'both') {
                datasets.push({
                    label: 'GMV (₹ Lakhs)',
                    data: gmvData,
                    borderColor: '#10b981',
                    backgroundColor: currentChartType === 'bar' ? '#10b981' : 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    yAxisID: currentMetric === 'both' ? 'y1' : 'y'
                });
            }

            charts.overview = new Chart(ctx, {
                type: currentChartType,
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: currentMetric === 'both'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' },
                            position: 'left'
                        },
                        y1: currentMetric === 'both' ? {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        } : {},
                        x: {
                            grid: { color: '#f1f5f9' }
                        }
                    }
                }
            });
        }

        function createTrendsChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            if (charts.trends) {
                charts.trends.destroy();
            }

            if (!filteredData.supplierData) return;

            // Get suppliers based on intelligent filter logic
            let suppliersToShow = [];
            const supplierTotals = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .sort((a, b) => b[1].bookings - a[1].bookings);

            switch (currentFilter) {
                case 'top5':
                    suppliersToShow = supplierTotals.slice(0, 5).map(([name]) => name);
                    break;
                case 'top10':
                    suppliersToShow = supplierTotals.slice(0, 10).map(([name]) => name);
                    break;
                case 'growing':
                    // Intelligent growth detection - suppliers with positive trend
                    suppliersToShow = supplierTotals
                        .filter(([name, data]) => {
                            const growth = calculateGrowthRate(name);
                            return growth > 0.02 && data.bookings > 100; // At least 2% growth and meaningful volume
                        })
                        .slice(0, 10)
                        .map(([name]) => name);
                    break;
                case 'volatile':
                    // Suppliers with high variance in daily bookings
                    suppliersToShow = supplierTotals
                        .filter(([name, data]) => {
                            const consistency = calculateConsistency(name);
                            return consistency < 0.5 && data.bookings > 200; // Low consistency, decent volume
                        })
                        .slice(0, 8)
                        .map(([name]) => name);
                    break;
                default:
                    // Smart selection: mix of top performers and interesting patterns
                    const topPerformers = supplierTotals.slice(0, 5).map(([name]) => name);
                    const growingSuppliers = supplierTotals
                        .filter(([name, data]) => calculateGrowthRate(name) > 0.05 && !topPerformers.includes(name))
                        .slice(0, 3)
                        .map(([name]) => name);
                    const volatileSuppliers = supplierTotals
                        .filter(([name, data]) => {
                            const consistency = calculateConsistency(name);
                            return consistency < 0.4 && data.bookings > 300 && !topPerformers.includes(name) && !growingSuppliers.includes(name);
                        })
                        .slice(0, 2)
                        .map(([name]) => name);
                    
                    suppliersToShow = [...topPerformers, ...growingSuppliers, ...volatileSuppliers];
            }

            if (suppliersToShow.length === 0) {
                suppliersToShow = supplierTotals.slice(0, 5).map(([name]) => name);
            }

            const colors = [
                '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',
                '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1',
                '#f43f5e', '#8b5cf6', '#06b6d4', '#84cc16', '#f97316'
            ];

            const datasets = suppliersToShow.map((supplier, index) => {
                const data = filteredData.dates.map(date => filteredData.supplierData[supplier][date]?.bookings || 0);
                const growth = calculateGrowthRate(supplier);
                const consistency = calculateConsistency(supplier);
                
                // Adjust line style based on characteristics
                let borderDash = undefined;
                let borderWidth = 2;
                
                if (growth > 0.05) {
                    borderWidth = 3; // Thicker line for growing suppliers
                }
                if (consistency < 0.5) {
                    borderDash = [5, 5]; // Dashed line for volatile suppliers
                }
                
                return {
                    label: `${supplier} ${growth > 0.05 ? '📈' : ''} ${consistency < 0.5 ? '⚡' : ''}`,
                    data: data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: borderWidth,
                    borderDash: borderDash,
                    fill: false,
                    tension: 0.1
                };
            });

            const title = {
                'all': 'Intelligent Trend Analysis: Top Performers + Growth + Volatility',
                'top5': 'Top 5 Performers by Total Volume',
                'top10': 'Top 10 Performers by Total Volume', 
                'growing': 'Growing Suppliers (>2% Weekly Growth)',
                'volatile': 'Volatile Suppliers (High Variance Patterns)'
            };

            charts.trends = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.dates.map(date => {
                        const d = new Date(date);
                        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                font: { size: 10 }
                            }
                        },
                        title: {
                            display: true,
                            text: title[currentFilter]
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { color: '#f1f5f9' }
                        }
                    }
                }
            });
        }

        let currentPredictionType = '7days';
        
        function createPredictionsChart() {
            const ctx = document.getElementById('predictionsChart').getContext('2d');
            
            if (charts.predictions) {
                charts.predictions.destroy();
            }

            if (!filteredData.dailyTotals) return;

            switch (currentPredictionType) {
                case '7days':
                    createNext7DaysPrediction(ctx);
                    break;
                case 'trends':
                    createGrowthTrendsAnalysis(ctx);
                    break;
                case 'seasonal':
                    createSeasonalAnalysis(ctx);
                    break;
            }
        }

        function createNext7DaysPrediction(ctx) {
            // Use last 21 days for better prediction accuracy
            const recentDays = filteredData.dates.slice(-21);
            const bookingsData = recentDays.map(date => filteredData.dailyTotals[date].bookings);
            
            // Calculate moving average and trend
            const movingAvg = [];
            const windowSize = 7;
            for (let i = windowSize - 1; i < bookingsData.length; i++) {
                const avg = bookingsData.slice(i - windowSize + 1, i + 1).reduce((a, b) => a + b, 0) / windowSize;
                movingAvg.push(avg);
            }
            
            // Calculate trend from moving average
            const n = movingAvg.length;
            const x = Array.from({length: n}, (_, i) => i);
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = movingAvg.reduce((a, b) => a + b, 0);
            const sumXY = x.map((xi, i) => xi * movingAvg[i]).reduce((a, b) => a + b, 0);
            const sumXX = x.map(xi => xi * xi).reduce((a, b) => a + b, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            // Add day-of-week seasonality
            const dayOfWeekAvg = new Array(7).fill(0);
            const dayOfWeekCount = new Array(7).fill(0);
            
            recentDays.forEach((date, index) => {
                const dayOfWeek = new Date(date).getDay();
                dayOfWeekAvg[dayOfWeek] += bookingsData[index];
                dayOfWeekCount[dayOfWeek]++;
            });
            
            for (let i = 0; i < 7; i++) {
                if (dayOfWeekCount[i] > 0) {
                    dayOfWeekAvg[i] /= dayOfWeekCount[i];
                }
            }
            
            const overallAvg = bookingsData.reduce((a, b) => a + b, 0) / bookingsData.length;
            const seasonalMultipliers = dayOfWeekAvg.map(avg => avg > 0 ? avg / overallAvg : 1);

            // Generate predictions with seasonality
            const futureLabels = [];
            const predictions = [];
            const today = new Date(Math.max(...filteredData.dates.map(d => new Date(d))));
            
            for (let i = 1; i <= 7; i++) {
                const futureDate = new Date(today);
                futureDate.setDate(today.getDate() + i);
                futureLabels.push(futureDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                const basePrediction = intercept + slope * (n + i);
                const dayOfWeek = futureDate.getDay();
                const seasonalPrediction = basePrediction * seasonalMultipliers[dayOfWeek];
                predictions.push(Math.max(0, Math.round(seasonalPrediction)));
            }

            const historicalLabels = recentDays.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            charts.predictions = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [...historicalLabels, ...futureLabels],
                    datasets: [
                        {
                            label: 'Historical Bookings',
                            data: [...bookingsData, ...Array(7).fill(null)],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: '7-Day Moving Average',
                            data: [...Array(windowSize - 1).fill(null), ...movingAvg, ...Array(7).fill(null)],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'AI Prediction (with Seasonality)',
                            data: [...Array(recentDays.length).fill(null), ...predictions],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: 'Next 7 Days Prediction with Day-of-Week Seasonality'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: { grid: { color: '#f1f5f9' } }
                    }
                }
            });
        }

        function createGrowthTrendsAnalysis(ctx) {
            // Analyze growth trends for top suppliers
            const suppliers = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .sort((a, b) => b[1].bookings - a[1].bookings)
                .slice(0, 8);

            const datasets = suppliers.map((supplier, index) => {
                const name = supplier[0];
                const data = filteredData.dates.map(date => filteredData.supplierData[name][date]?.bookings || 0);
                
                // Calculate growth rate using 7-day moving average
                const movingAvg = [];
                const windowSize = 7;
                for (let i = windowSize - 1; i < data.length; i++) {
                    const avg = data.slice(i - windowSize + 1, i + 1).reduce((a, b) => a + b, 0) / windowSize;
                    movingAvg.push(avg);
                }
                
                // Calculate growth percentage
                const growthData = [];
                for (let i = 1; i < movingAvg.length; i++) {
                    if (movingAvg[i - 1] > 0) {
                        const growth = ((movingAvg[i] - movingAvg[i - 1]) / movingAvg[i - 1]) * 100;
                        growthData.push(Math.max(-50, Math.min(50, growth))); // Cap at ±50%
                    } else {
                        growthData.push(0);
                    }
                }

                const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
                
                return {
                    label: name,
                    data: [...Array(windowSize).fill(null), ...growthData],
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                };
            });

            charts.predictions = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.dates.map(date => {
                        const d = new Date(date);
                        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: 'Supplier Growth Trends (7-day Moving Average Growth %)'
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: '#f1f5f9' },
                            title: { display: true, text: 'Growth Rate (%)' }
                        },
                        x: { grid: { color: '#f1f5f9' } }
                    }
                }
            });
        }

        function createSeasonalAnalysis(ctx) {
            // Analyze day-of-week and monthly patterns
            const dayOfWeekData = new Array(7).fill(0);
            const dayOfWeekCount = new Array(7).fill(0);
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            filteredData.dates.forEach(date => {
                const dayOfWeek = new Date(date).getDay();
                const bookings = filteredData.dailyTotals[date].bookings;
                dayOfWeekData[dayOfWeek] += bookings;
                dayOfWeekCount[dayOfWeek]++;
            });
            
            // Calculate averages
            for (let i = 0; i < 7; i++) {
                if (dayOfWeekCount[i] > 0) {
                    dayOfWeekData[i] /= dayOfWeekCount[i];
                }
            }

            // Monthly analysis
            const monthlyData = {};
            const monthlyCount = {};
            
            filteredData.dates.forEach(date => {
                const dateObj = new Date(date);
                const monthKey = dateObj.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                const bookings = filteredData.dailyTotals[date].bookings;
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = 0;
                    monthlyCount[monthKey] = 0;
                }
                monthlyData[monthKey] += bookings;
                monthlyCount[monthKey]++;
            });
            
            const monthlyAvg = Object.keys(monthlyData).map(month => ({
                month,
                avg: monthlyData[month] / monthlyCount[month]
            })).sort((a, b) => new Date(a.month) - new Date(b.month));

            charts.predictions = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [...dayNames, '---', ...monthlyAvg.map(m => m.month)],
                    datasets: [
                        {
                            label: 'Day of Week Average',
                            data: [...dayOfWeekData, null, ...Array(monthlyAvg.length).fill(null)],
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        },
                        {
                            label: 'Monthly Average',
                            data: [...Array(8).fill(null), ...monthlyAvg.map(m => m.avg)],
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: 'Seasonal Patterns: Day-of-Week vs Monthly Trends'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' },
                            title: { display: true, text: 'Average Daily Bookings' }
                        },
                        x: { grid: { color: '#f1f5f9' } }
                    }
                }
            });
        }

        let currentOptimizationType = 'performance';

        function createOptimizationChart() {
            const ctx = document.getElementById('optimizationChart').getContext('2d');
            
            if (charts.optimization) {
                charts.optimization.destroy();
            }

            if (!filteredData.supplierTotals) return;

            switch (currentOptimizationType) {
                case 'performance':
                    createPerformanceVsVolumeMatrix(ctx);
                    break;
                case 'efficiency':
                    createEfficiencyAnalysis(ctx);
                    break;
                case 'potential':
                    createGrowthPotentialMatrix(ctx);
                    break;
            }
        }

        function createPerformanceVsVolumeMatrix(ctx) {
            const scatterData = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .map(([name, data]) => ({
                    x: data.bookings,
                    y: data.bookings > 0 ? data.gmv / data.bookings : 0,
                    supplier: name,
                    gmv: data.gmv
                }))
                .filter(point => point.x > 10);

            charts.optimization = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Suppliers',
                        data: scatterData,
                        backgroundColor: scatterData.map(point => {
                            if (point.x > 500 && point.y > 15000) return '#10b981'; // High volume, high value - Stars
                            if (point.x > 500) return '#f59e0b'; // High volume, low value - Workhorses
                            if (point.y > 15000) return '#8b5cf6'; // Low volume, high value - Premium
                            return '#ef4444'; // Low volume, low value - Underperformers
                        }),
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        pointRadius: scatterData.map(point => {
                            const radius = Math.max(6, Math.min(15, point.gmv / 500000));
                            return radius;
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Supplier Performance Matrix: Volume vs Booking Value'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    let category = 'Underperformer';
                                    if (point.x > 500 && point.y > 15000) category = '⭐ Star Performer';
                                    else if (point.x > 500) category = '🔧 Workhorse';
                                    else if (point.y > 15000) category = '💎 Premium Partner';
                                    
                                    return [
                                        `${point.supplier} (${category})`,
                                        `Bookings: ${point.x.toLocaleString()}`,
                                        `Avg Value: ₹${Math.round(point.y/1000)}k`,
                                        `Total GMV: ₹${Math.round(point.gmv/100000)}L`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Total Bookings (Volume)' },
                            grid: { color: '#f1f5f9' }
                        },
                        y: {
                            title: { display: true, text: 'Average Booking Value (₹)' },
                            grid: { color: '#f1f5f9' }
                        }
                    }
                }
            });
        }

        function createEfficiencyAnalysis(ctx) {
            const suppliers = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .map(([name, data]) => {
                    const efficiency = data.days > 0 ? data.bookings / data.days : 0; // Bookings per active day
                    const consistency = calculateConsistency(name);
                    return {
                        x: efficiency,
                        y: consistency,
                        supplier: name,
                        bookings: data.bookings,
                        activeDays: data.days,
                        gmv: data.gmv
                    };
                })
                .filter(point => point.x > 1);

            charts.optimization = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Suppliers',
                        data: suppliers,
                        backgroundColor: suppliers.map(point => {
                            if (point.x > 30 && point.y > 0.7) return '#10b981'; // High efficiency, high consistency
                            if (point.x > 30) return '#f59e0b'; // High efficiency, low consistency
                            if (point.y > 0.7) return '#8b5cf6'; // Low efficiency, high consistency
                            return '#ef4444'; // Low efficiency, low consistency
                        }),
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        pointRadius: suppliers.map(point => Math.max(6, Math.min(15, point.bookings / 200)))
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Supplier Efficiency Analysis: Daily Performance vs Consistency'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    let category = 'Needs Improvement';
                                    if (point.x > 30 && point.y > 0.7) category = '🚀 Highly Efficient';
                                    else if (point.x > 30) category = '⚡ High Output';
                                    else if (point.y > 0.7) category = '🎯 Reliable';
                                    
                                    return [
                                        `${point.supplier} (${category})`,
                                        `Daily Avg: ${point.x.toFixed(1)} bookings`,
                                        `Consistency: ${(point.y * 100).toFixed(1)}%`,
                                        `Active Days: ${point.activeDays}`,
                                        `Total Bookings: ${point.bookings.toLocaleString()}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Daily Efficiency (Bookings per Active Day)' },
                            grid: { color: '#f1f5f9' }
                        },
                        y: {
                            title: { display: true, text: 'Consistency Score (0-1)' },
                            grid: { color: '#f1f5f9' },
                            min: 0,
                            max: 1
                        }
                    }
                }
            });
        }

        function createGrowthPotentialMatrix(ctx) {
            const suppliers = Object.entries(filteredData.supplierTotals)
                .filter(([name]) => filteredData.suppliers.includes(name))
                .map(([name, data]) => {
                    const growthRate = calculateGrowthRate(name);
                    const marketPotential = data.bookings > 0 ? (data.gmv / data.bookings) / 1000 : 0; // Normalized potential
                    return {
                        x: growthRate,
                        y: marketPotential,
                        supplier: name,
                        bookings: data.bookings,
                        gmv: data.gmv
                    };
                })
                .filter(point => point.supplier);

            charts.optimization = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Suppliers',
                        data: suppliers,
                        backgroundColor: suppliers.map(point => {
                            if (point.x > 0.05 && point.y > 20) return '#10b981'; // High growth, high potential
                            if (point.x > 0.05) return '#f59e0b'; // High growth, low potential
                            if (point.y > 20) return '#8b5cf6'; // Low growth, high potential
                            return '#ef4444'; // Low growth, low potential
                        }),
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        pointRadius: suppliers.map(point => Math.max(6, Math.min(15, Math.sqrt(point.bookings) / 5)))
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Growth Potential Matrix: Recent Growth vs Market Value'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    let category = 'Monitor';
                                    if (point.x > 0.05 && point.y > 20) category = '🌟 Rising Star';
                                    else if (point.x > 0.05) category = '📈 Fast Grower';
                                    else if (point.y > 20) category = '💰 High Value';
                                    
                                    return [
                                        `${point.supplier} (${category})`,
                                        `Growth Rate: ${(point.x * 100).toFixed(1)}%`,
                                        `Value Potential: ${point.y.toFixed(1)}k`,
                                        `Total Bookings: ${point.bookings.toLocaleString()}`,
                                        `GMV: ₹${Math.round(point.gmv/100000)}L`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Recent Growth Rate (Weekly %)' },
                            grid: { color: '#f1f5f9' }
                        },
                        y: {
                            title: { display: true, text: 'Market Value Potential (₹k)' },
                            grid: { color: '#f1f5f9' }
                        }
                    }
                }
            });
        }

        function calculateConsistency(supplierName) {
            const supplierDailyData = filteredData.dates.map(date => 
                filteredData.supplierData[supplierName][date]?.bookings || 0
            ).filter(bookings => bookings > 0); // Only count active days
            
            if (supplierDailyData.length < 5) return 0;
            
            const mean = supplierDailyData.reduce((a, b) => a + b, 0) / supplierDailyData.length;
            const variance = supplierDailyData.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / supplierDailyData.length;
            const stdDev = Math.sqrt(variance);
            
            // Coefficient of variation (lower is more consistent)
            const cv = mean > 0 ? stdDev / mean : 1;
            // Convert to consistency score (0-1, where 1 is most consistent)
            return Math.max(0, Math.min(1, 1 - (cv / 2)));
        }

        function calculateGrowthRate(supplierName) {
            const data = filteredData.dates.map(date => 
                filteredData.supplierData[supplierName][date]?.bookings || 0
            );
            
            if (data.length < 14) return 0;
            
            // Compare last week vs previous week
            const lastWeek = data.slice(-7).reduce((a, b) => a + b, 0);
            const prevWeek = data.slice(-14, -7).reduce((a, b) => a + b, 0);
            
            if (prevWeek === 0) return lastWeek > 0 ? 0.5 : 0;
            return (lastWeek - prevWeek) / prevWeek;
        }

        // Add welcome animation for new users
        function showWelcomeAnimation() {
            const welcomeOverlay = document.createElement('div');
            welcomeOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.5s;
            `;
            
            welcomeOverlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    padding: 3rem;
                    border-radius: 2rem;
                    text-align: center;
                    color: white;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    max-width: 500px;
                    margin: 2rem;
                    animation: welcomePopIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                ">
                    <h2 style="font-size: 2rem; margin-bottom: 1rem; animation: welcomeGlow 2s ease-in-out infinite alternate;">
                        🎉 Welcome to Your AI Dashboard! 🎉
                    </h2>
                    <p style="font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9;">
                        Navigate through these magical tabs to discover powerful insights about your hotel booking business!
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin: 2rem 0; flex-wrap: wrap;">
                        <div style="background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);">📊 Overview</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);">🎯 Suppliers</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);">📈 Trends</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);">🔮 Predictions</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);">⚡ Optimization</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.style.display='none'" style="
                        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                        color: white;
                        border: none;
                        padding: 1rem 2rem;
                        border-radius: 2rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        🚀 Let's Explore!
                    </button>
                </div>
            `;
            
            document.body.appendChild(welcomeOverlay);
            setTimeout(() => welcomeOverlay.style.opacity = '1', 100);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (welcomeOverlay.parentElement) {
                    welcomeOverlay.style.opacity = '0';
                    setTimeout(() => welcomeOverlay.remove(), 500);
                }
            }, 10000);
        }

        // Add CSS animations
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            @keyframes welcomePopIn {
                0% {
                    transform: scale(0.5) rotate(-10deg);
                    opacity: 0;
                }
                100% {
                    transform: scale(1) rotate(0deg);
                    opacity: 1;
                }
            }
            
            @keyframes welcomeGlow {
                from { text-shadow: 0 0 10px rgba(255,255,255,0.5); }
                to { text-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 30px rgba(255,255,255,0.6); }
            }
            
            .tab-indicator {
                position: absolute;
                top: -10px;
                right: -5px;
                background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                color: white;
                font-size: 0.7rem;
                padding: 0.2rem 0.5rem;
                border-radius: 1rem;
                animation: pulse 2s infinite;
                font-weight: 600;
                box-shadow: 0 2px 8px rgba(255,107,107,0.4);
            }
            
            .nav-tab:hover .tab-indicator {
                animation: bounce 0.6s;
            }
            
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-8px); }
                60% { transform: translateY(-4px); }
            }
        `;
        document.head.appendChild(styleSheet);

        // Enhanced tab switching with animations
        function switchTab(tabName) {
            // Remove all active classes
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.style.opacity = '0';
                tab.style.transform = 'translateY(20px)';
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to selected elements
            const selectedTab = document.getElementById(tabName);
            const selectedNavTab = event.target;
            
            selectedNavTab.classList.add('active');
            
            // Animate tab content appearance
            setTimeout(() => {
                selectedTab.classList.add('active');
                selectedTab.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                selectedTab.style.opacity = '1';
                selectedTab.style.transform = 'translateY(0)';
            }, 100);

            // Add celebration effect for first-time users
            if (Math.random() < 0.3) { // 30% chance for fun
                createConfetti(selectedNavTab);
            }
        }

        function createConfetti(element) {
            for (let i = 0; i < 15; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    width: 6px;
                    height: 6px;
                    background: ${['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'][Math.floor(Math.random() * 5)]};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1000;
                `;
                
                const rect = element.getBoundingClientRect();
                confetti.style.left = (rect.left + rect.width/2) + 'px';
                confetti.style.top = (rect.top + rect.height/2) + 'px';
                
                document.body.appendChild(confetti);
                
                // Animate confetti
                const angle = (Math.PI * 2 * i) / 15;
                const velocity = 100 + Math.random() * 100;
                const lifetime = 1000 + Math.random() * 1000;
                
                confetti.animate([
                    { transform: 'translate(0, 0) scale(0)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity - 200}px) scale(1)`, opacity: 0 }
                ], {
                    duration: lifetime,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                }).onfinish = () => confetti.remove();
            }
        }

        function toggleChartType(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-controls .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            createOverviewChart();
        }

        function toggleChartMetric(metric) {
            currentMetric = metric;
            createOverviewChart();
        }

        function filterTopSuppliers(filter) {
            currentFilter = filter;
            document.querySelectorAll('#trends .chart-controls .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            createTrendsChart();
        }

        function showPrediction(type) {
            currentPredictionType = type;
            
            // Update button states
            document.querySelectorAll('#predictions .chart-controls .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            createPredictionsChart();
        }

        function showOptimization(type) {
            currentOptimizationType = type;
            
            // Update button states  
            document.querySelectorAll('#optimization .chart-controls .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            createOptimizationChart();
        }

        // Utility functions
        function showLoading() {
            document.querySelectorAll('.metric-value').forEach(el => {
                el.innerHTML = '<div class="spinner"></div>Loading...';
            });
        }

        function hideLoading() {
            // Loading will be replaced by actual data
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
        }

        function showSuccess(message) {
            const container = document.querySelector('.container');
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            container.insertBefore(successDiv, container.firstChild);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Initialize dashboard with security check
        function initializeDashboard() {
            console.log('AI-Enhanced Dashboard initializing...');
            
            // Add logout button for authenticated users
            if (isAuthenticated && currentUser) {
                const logoutBtn = document.createElement('button');
                logoutBtn.innerHTML = `👋 Logout (${currentUser.role})`;
                logoutBtn.style.cssText = `
                    position: fixed;
                    top: 1rem;
                    right: 1rem;
                    background: rgba(239, 68, 68, 0.9);
                    color: white;
                    border: none;
                    padding: 0.5rem 1rem;
                    border-radius: 0.5rem;
                    cursor: pointer;
                    font-size: 0.875rem;
                    z-index: 1000;
                    transition: all 0.2s;
                `;
                logoutBtn.onmouseover = () => logoutBtn.style.background = '#dc2626';
                logoutBtn.onmouseout = () => logoutBtn.style.background = 'rgba(239, 68, 68, 0.9)';
                logoutBtn.onclick = logout;
                document.body.appendChild(logoutBtn);
            }

            // Show welcome animation for new users
            const isFirstTime = !sessionStorage.getItem('dashboardVisited');
            if (isFirstTime || Math.random() < 0.1) {
                setTimeout(showWelcomeAnimation, 1500);
                sessionStorage.setItem('dashboardVisited', 'true');
            }
            
            // Add notification badges to tabs for new users
            if (isFirstTime) {
                setTimeout(() => {
                    const tabs = ['yesterday', 'suppliers', 'trends', 'predictions', 'optimization'];
                    tabs.forEach((tab, index) => {
                        setTimeout(() => {
                            const tabElement = document.querySelector(`[data-tab="${tab}"]`);
                            if (tabElement && !tabElement.querySelector('.tab-indicator')) {
                                const indicator = document.createElement('span');
                                indicator.className = 'tab-indicator';
                                indicator.textContent = 'NEW';
                                indicator.style.position = 'absolute';
                                tabElement.style.position = 'relative';
                                tabElement.appendChild(indicator);
                                
                                setTimeout(() => {
                                    indicator.style.opacity = '0';
                                    setTimeout(() => indicator.remove(), 300);
                                }, 30000);
                            }
                        }, index * 1000);
                    });
                }, 3000);
            }
            
            loadBookingData();
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (checkSession()) {
                initializeDashboard();
            } else {
                showLoginScreen();
            }
        });
    </script>
</body>
</html>
